{"content":{"metadata":{"name":"AnomalyDetectionDemo","user_save_timestamp":"1970-01-01T01:00:00.000Z","auto_save_timestamp":"1970-01-01T01:00:00.000Z","language_info":{"name":"scala","file_extension":"scala","codemirror_mode":"text/x-scala"},"trusted":true,"customLocalRepo":null,"customRepos":null,"customDeps":null,"customImports":null,"customSparkConf":{"spark.app.name":"Notebook","spark.master":"local[8]","spark.driver.memory":"10G"}},"cells":[{"metadata":{},"cell_type":"markdown","source":"#Spark Use Case for Anomaly Detection"},{"metadata":{},"cell_type":"markdown","source":"#### Anomaly Detection with Apache Spark - inspired by Sean Owen's presentation https://www.youtube.com/watch?v=TC5cKYBZAeI\n\n#### Data downloaded from: http://kdd.ics.uci.edu/databases/kddcup99/kddcup99.html"},{"metadata":{},"cell_type":"markdown","source":"## Set up"},{"metadata":{},"cell_type":"markdown","source":"### Set local repo for deps"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":":local-repo /tmp/repo","outputs":[{"name":"stdout","output_type":"stream","text":"res4: String = Repo changed to /tmp/repo!\n"},{"metadata":{},"data":{"text/html":"Repo changed to /tmp/repo!\n <div class='pull-right text-info'><small>286 milliseconds</small></div>"},"output_type":"execute_result","execution_count":3}]},{"metadata":{},"cell_type":"markdown","source":"### Add streaming deps "},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true},"cell_type":"code","source":"//:dp org.apache.spark % spark-streaming_2.10 % 1.2.1\n//- org.apache.spark % spark-core_2.10 % _\n//- org.apache.hadoop % _ % _","outputs":[]},{"metadata":{},"cell_type":"markdown","source":"### All the imports"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"import org.apache.spark.sql.SQLContext\nimport org.apache.spark.mllib.clustering._\nimport org.apache.spark.mllib.linalg._\nimport org.apache.spark.mllib.feature.StandardScaler\nimport org.apache.spark.mllib.util.MLUtils\nimport org.apache.spark.rdd._\nimport org.apache.spark.sql.Row\nimport org.apache.spark.streaming._\nimport org.apache.spark.Logging\nimport org.apache.log4j.{Level, Logger}","outputs":[{"name":"stdout","output_type":"stream","text":"import org.apache.spark.sql.SQLContext\nimport org.apache.spark.mllib.clustering._\nimport org.apache.spark.mllib.linalg._\nimport org.apache.spark.mllib.feature.StandardScaler\nimport org.apache.spark.mllib.util.MLUtils\nimport org.apache.spark.rdd._\nimport org.apache.spark.sql.Row\nimport org.apache.spark.streaming._\nimport org.apache.spark.Logging\nimport org.apache.log4j.{Level, Logger}\n"},{"metadata":{},"data":{"text/html":"\n <div class='pull-right text-info'><small>117 milliseconds</small></div>"},"output_type":"execute_result","execution_count":6}]},{"metadata":{},"cell_type":"markdown","source":"***\n## Reading in and exploring the data -- Spark SQL (and DataFrame)"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val sqlContext = new SQLContext(sparkContext)\n//-rw-r--r--  1 radek  staff   4.3G 15 May 23:44 kddcup.data.json.big\nval dataFrame = sqlContext.jsonFile(\"/Users/radek/lab/data/kddcup.data.json.big\").cache","outputs":[{"name":"stdout","output_type":"stream","text":"sqlContext: org.apache.spark.sql.SQLContext = org.apache.spark.sql.SQLContext@15a10365\ndataFrame: org.apache.spark.sql.DataFrame = [count: string, diff_srv_rate: string, dst_bytes: string, dst_host_count: string, dst_host_diff_srv_rate: string, dst_host_rerror_rate: string, dst_host_same_src_port_rate: string, dst_host_same_srv_rate: string, dst_host_serror_rate: string, dst_host_srv_count: string, dst_host_srv_diff_host_rate: string, dst_host_srv_rerror_rate: string, dst_host_srv_serror_rate: string, duration: string, flag: string, hot: string, is_guest_login: string, is_host_login: string, label: string, land: string, logged_in: string, num_access_files: string, num_compromised: string, num_failed_logins: string, num_file_creations: string, num_outbound_cmds: string, num_root: string,..."},{"metadata":{},"data":{"text/html":"[count: string, diff_srv_rate: string, dst_bytes: string, dst_host_count: string, dst_host_diff_srv_rate: string, dst_host_rerror_rate: string, dst_host_same_src_port_rate: string, dst_host_same_srv_rate: string, dst_host_serror_rate: string, dst_host_srv_count: string, dst_host_srv_diff_host_rate: string, dst_host_srv_rerror_rate: string, dst_host_srv_serror_rate: string, duration: string, flag: string, hot: string, is_guest_login: string, is_host_login: string, label: string, land: string, logged_in: string, num_access_files: string, num_compromised: string, num_failed_logins: string, num_file_creations: string, num_outbound_cmds: string, num_root: string, num_shells: string, protocol_type: string, rerror_rate: string, root_shell: string, same_srv_rate: string, serror_rate: string, service: string, src_bytes: string, srv_count: string, srv_diff_host_rate: string, srv_rerror_rate: string, srv_serror_rate: string, su_attempted: string, urgent: string, wrong_fragment: string]\n <div class='pull-right text-info'><small>1 minute 5 seconds 101 milliseconds</small></div>"},"output_type":"execute_result","execution_count":7}]},{"metadata":{},"cell_type":"markdown","source":"### We are using a modified training dataset from the competition"},{"metadata":{},"cell_type":"markdown","source":"<code>{\"duration\":\"0\",\"protocol_type\":\"tcp\",\"service\":\"http\",\"flag\":\"SF\",\"src_bytes\":\"215\",\"dst_bytes\":\"45076\",\"land\":\"0\",\n\"wrong_fragment\":\"0\",\"urgent\":\"0\",\"hot\":\"0\",\"num_failed_logins\":\"0\",\"logged_in\":\"1\",\"num_compromised\":\"0\",\n\"root_shell\":\"0\",\"su_attempted\":\"0\",\"num_root\":\"0\",\"num_file_creations\":\"0\",\"num_shells\":\"0\",\"num_access_files\":\"0\",\n\"num_outbound_cmds\":\"0\",\"is_host_login\":\"0\",\"is_guest_login\":\"0\",\"count\":\"1\",\"srv_count\":\"1\",\"serror_rate\":\"0.00\",\n\"srv_serror_rate\":\"0.00\",\"rerror_rate\":\"0.00\",\"srv_rerror_rate\":\"0.00\",\"same_srv_rate\":\"1.00\",\"diff_srv_rate\":\"0.00\",\n\"srv_diff_host_rate\":\"0.00\",\"dst_host_count\":\"0\",\"dst_host_srv_count\":\"0\",\"dst_host_same_srv_rate\":\"0.00\",\n\"dst_host_diff_srv_rate\":\"0.00\",\"dst_host_same_src_port_rate\":\"0.00\",\"dst_host_srv_diff_host_rate\":\"0.00\",\n\"dst_host_serror_rate\":\"0.00\",\"dst_host_srv_serror_rate\":\"0.00\",\"dst_host_rerror_rate\":\"0.00\",\n\"dst_host_srv_rerror_rate\":\"0.00\",\"label\":\"normal.\"}\n</code>"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"dataFrame.printSchema","outputs":[{"name":"stdout","output_type":"stream","text":"root\n |-- count: string (nullable = true)\n |-- diff_srv_rate: string (nullable = true)\n |-- dst_bytes: string (nullable = true)\n |-- dst_host_count: string (nullable = true)\n |-- dst_host_diff_srv_rate: string (nullable = true)\n |-- dst_host_rerror_rate: string (nullable = true)\n |-- dst_host_same_src_port_rate: string (nullable = true)\n |-- dst_host_same_srv_rate: string (nullable = true)\n |-- dst_host_serror_rate: string (nullable = true)\n |-- dst_host_srv_count: string (nullable = true)\n |-- dst_host_srv_diff_host_rate: string (nullable = true)\n |-- dst_host_srv_rerror_rate: string (nullable = true)\n |-- dst_host_srv_serror_rate: string (nullable = true)\n |-- duration: string (nullable = true)\n |-- flag: string (nullable = true)\n |-- hot: string (nullable = true)\n |-- is_guest_login: string (nullable = true)\n |-- is_host_login: string (nullable = true)\n |-- label: string (nullable = true)\n |-- land: string (nullable = true)\n |-- logged_in: string (nullable = true)\n |-- num_access_files: string (nullable = true)\n |-- num_compromised: string (nullable = true)\n |-- num_failed_logins: string (nullable = true)\n |-- num_file_creations: string (nullable = true)\n |-- num_outbound_cmds: string (nullable = true)\n |-- num_root: string (nullable = true)\n |-- num_shells: string (nullable = true)\n |-- protocol_type: string (nullable = true)\n |-- rerror_rate: string (nullable = true)\n |-- root_shell: string (nullable = true)\n |-- same_srv_rate: string (nullable = true)\n |-- serror_rate: string (nullable = true)\n |-- service: string (nullable = true)\n |-- src_bytes: string (nullable = true)\n |-- srv_count: string (nullable = true)\n |-- srv_diff_host_rate: string (nullable = true)\n |-- srv_rerror_rate: string (nullable = true)\n |-- srv_serror_rate: string (nullable = true)\n |-- su_attempted: string (nullable = true)\n |-- urgent: string (nullable = true)\n |-- wrong_fragment: string (nullable = true)\n\n"},{"metadata":{},"data":{"text/html":"\n <div class='pull-right text-info'><small>325 milliseconds</small></div>"},"output_type":"execute_result","execution_count":8}]},{"metadata":{},"cell_type":"markdown","source":"#### There are nearly 5 million records"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"dataFrame.count","outputs":[{"name":"stdout","output_type":"stream","text":"res8: Long = 4898431\n"},{"metadata":{},"data":{"text/html":"4898431\n <div class='pull-right text-info'><small>1 minute 5 seconds 847 milliseconds</small></div>"},"output_type":"execute_result","execution_count":9}]},{"metadata":{},"cell_type":"markdown","source":"### Let's look at the labels"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val labelsCount = dataFrame.groupBy(\"label\").count().collect","outputs":[{"name":"stdout","output_type":"stream","text":"labelsCount: Array[org.apache.spark.sql.Row] = Array([satan.,15892], [rootkit.,10], [portsweep.,10413], [ipsweep.,12481], [land.,21], [imap.,12], [nmap.,2316], [neptune.,1072017], [normal.,972781], [back.,2203], [warezclient.,1020], [guess_passwd.,53], [ftp_write.,8], [phf.,4], [multihop.,7], [loadmodule.,9], [smurf.,2807886], [perl.,3], [spy.,2], [buffer_overflow.,30], [pod.,264], [teardrop.,979], [warezmaster.,20])\n"},{"metadata":{},"data":{"text/html":"[Lorg.apache.spark.sql.Row;@232c3633\n <div class='pull-right text-info'><small>6 seconds 459 milliseconds</small></div>"},"output_type":"execute_result","execution_count":10}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"labelsCount.toList.map( row => (row.getString(0), row.getLong(1)))","outputs":[{"name":"stdout","output_type":"stream","text":"res9: List[(String, Long)] = List((satan.,15892), (rootkit.,10), (portsweep.,10413), (ipsweep.,12481), (land.,21), (imap.,12), (nmap.,2316), (neptune.,1072017), (normal.,972781), (back.,2203), (warezclient.,1020), (guess_passwd.,53), (ftp_write.,8), (phf.,4), (multihop.,7), (loadmodule.,9), (smurf.,2807886), (perl.,3), (spy.,2), (buffer_overflow.,30), (pod.,264), (teardrop.,979), (warezmaster.,20))\n"},{"metadata":{},"data":{"text/html":"<div>\n    <script data-this=\"{&quot;dataId&quot;:&quot;anon6f3e1ee5e3896b8628feff657bc916c7&quot;,&quot;dataInit&quot;:[{&quot;X&quot;:&quot;satan.&quot;,&quot;Y&quot;:&quot;15892&quot;},{&quot;X&quot;:&quot;rootkit.&quot;,&quot;Y&quot;:&quot;10&quot;},{&quot;X&quot;:&quot;portsweep.&quot;,&quot;Y&quot;:&quot;10413&quot;},{&quot;X&quot;:&quot;ipsweep.&quot;,&quot;Y&quot;:&quot;12481&quot;},{&quot;X&quot;:&quot;land.&quot;,&quot;Y&quot;:&quot;21&quot;},{&quot;X&quot;:&quot;imap.&quot;,&quot;Y&quot;:&quot;12&quot;},{&quot;X&quot;:&quot;nmap.&quot;,&quot;Y&quot;:&quot;2316&quot;},{&quot;X&quot;:&quot;neptune.&quot;,&quot;Y&quot;:&quot;1072017&quot;},{&quot;X&quot;:&quot;normal.&quot;,&quot;Y&quot;:&quot;972781&quot;},{&quot;X&quot;:&quot;back.&quot;,&quot;Y&quot;:&quot;2203&quot;},{&quot;X&quot;:&quot;warezclient.&quot;,&quot;Y&quot;:&quot;1020&quot;},{&quot;X&quot;:&quot;guess_passwd.&quot;,&quot;Y&quot;:&quot;53&quot;},{&quot;X&quot;:&quot;ftp_write.&quot;,&quot;Y&quot;:&quot;8&quot;},{&quot;X&quot;:&quot;phf.&quot;,&quot;Y&quot;:&quot;4&quot;},{&quot;X&quot;:&quot;multihop.&quot;,&quot;Y&quot;:&quot;7&quot;},{&quot;X&quot;:&quot;loadmodule.&quot;,&quot;Y&quot;:&quot;9&quot;},{&quot;X&quot;:&quot;smurf.&quot;,&quot;Y&quot;:&quot;2807886&quot;},{&quot;X&quot;:&quot;perl.&quot;,&quot;Y&quot;:&quot;3&quot;},{&quot;X&quot;:&quot;spy.&quot;,&quot;Y&quot;:&quot;2&quot;},{&quot;X&quot;:&quot;buffer_overflow.&quot;,&quot;Y&quot;:&quot;30&quot;},{&quot;X&quot;:&quot;pod.&quot;,&quot;Y&quot;:&quot;264&quot;},{&quot;X&quot;:&quot;teardrop.&quot;,&quot;Y&quot;:&quot;979&quot;},{&quot;X&quot;:&quot;warezmaster.&quot;,&quot;Y&quot;:&quot;20&quot;}],&quot;genId&quot;:&quot;2120066267&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tabs'], \n      function(playground, _magictabs) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictabs,\n    \"o\": {}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script><div>\n        <ul class=\"nav nav-tabs\" id=\"ul2120066267\"><li>\n              <a href=\"#tab2120066267-0\"><i class=\"fa fa-table\"/></a>\n            </li><li>\n              <a href=\"#tab2120066267-1\"><i class=\"fa fa-bar-chart\"/></a>\n            </li><li>\n              <a href=\"#tab2120066267-2\"><i class=\"fa fa-pie-chart\"/></a>\n            </li></ul>\n\n        <div class=\"tab-content\" id=\"tab2120066267\"><div class=\"tab-pane\" id=\"tab2120066267-0\">\n            <div>\n    <script data-this=\"{&quot;dataId&quot;:&quot;anonab3222e09e7136ff1bb7611f56cc7522&quot;,&quot;dataInit&quot;:[{&quot;X&quot;:&quot;satan.&quot;,&quot;Y&quot;:&quot;15892&quot;},{&quot;X&quot;:&quot;rootkit.&quot;,&quot;Y&quot;:&quot;10&quot;},{&quot;X&quot;:&quot;portsweep.&quot;,&quot;Y&quot;:&quot;10413&quot;},{&quot;X&quot;:&quot;ipsweep.&quot;,&quot;Y&quot;:&quot;12481&quot;},{&quot;X&quot;:&quot;land.&quot;,&quot;Y&quot;:&quot;21&quot;},{&quot;X&quot;:&quot;imap.&quot;,&quot;Y&quot;:&quot;12&quot;},{&quot;X&quot;:&quot;nmap.&quot;,&quot;Y&quot;:&quot;2316&quot;},{&quot;X&quot;:&quot;neptune.&quot;,&quot;Y&quot;:&quot;1072017&quot;},{&quot;X&quot;:&quot;normal.&quot;,&quot;Y&quot;:&quot;972781&quot;},{&quot;X&quot;:&quot;back.&quot;,&quot;Y&quot;:&quot;2203&quot;},{&quot;X&quot;:&quot;warezclient.&quot;,&quot;Y&quot;:&quot;1020&quot;},{&quot;X&quot;:&quot;guess_passwd.&quot;,&quot;Y&quot;:&quot;53&quot;},{&quot;X&quot;:&quot;ftp_write.&quot;,&quot;Y&quot;:&quot;8&quot;},{&quot;X&quot;:&quot;phf.&quot;,&quot;Y&quot;:&quot;4&quot;},{&quot;X&quot;:&quot;multihop.&quot;,&quot;Y&quot;:&quot;7&quot;},{&quot;X&quot;:&quot;loadmodule.&quot;,&quot;Y&quot;:&quot;9&quot;},{&quot;X&quot;:&quot;smurf.&quot;,&quot;Y&quot;:&quot;2807886&quot;},{&quot;X&quot;:&quot;perl.&quot;,&quot;Y&quot;:&quot;3&quot;},{&quot;X&quot;:&quot;spy.&quot;,&quot;Y&quot;:&quot;2&quot;},{&quot;X&quot;:&quot;buffer_overflow.&quot;,&quot;Y&quot;:&quot;30&quot;},{&quot;X&quot;:&quot;pod.&quot;,&quot;Y&quot;:&quot;264&quot;},{&quot;X&quot;:&quot;teardrop.&quot;,&quot;Y&quot;:&quot;979&quot;},{&quot;X&quot;:&quot;warezmaster.&quot;,&quot;Y&quot;:&quot;20&quot;}],&quot;genId&quot;:&quot;816154216&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tableChart'], \n      function(playground, _magictableChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictableChart,\n    \"o\": {\"headers\":[\"X\",\"Y\"],\"nrow\":23,\"shown\":25,\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script></div>\n            </div><div class=\"tab-pane\" id=\"tab2120066267-1\">\n            <div>\n    <script data-this=\"{&quot;dataId&quot;:&quot;anon8977ec1b31881ddecc7fd280de1dd589&quot;,&quot;dataInit&quot;:[{&quot;X&quot;:&quot;satan.&quot;,&quot;Y&quot;:&quot;15892&quot;},{&quot;X&quot;:&quot;rootkit.&quot;,&quot;Y&quot;:&quot;10&quot;},{&quot;X&quot;:&quot;portsweep.&quot;,&quot;Y&quot;:&quot;10413&quot;},{&quot;X&quot;:&quot;ipsweep.&quot;,&quot;Y&quot;:&quot;12481&quot;},{&quot;X&quot;:&quot;land.&quot;,&quot;Y&quot;:&quot;21&quot;},{&quot;X&quot;:&quot;imap.&quot;,&quot;Y&quot;:&quot;12&quot;},{&quot;X&quot;:&quot;nmap.&quot;,&quot;Y&quot;:&quot;2316&quot;},{&quot;X&quot;:&quot;neptune.&quot;,&quot;Y&quot;:&quot;1072017&quot;},{&quot;X&quot;:&quot;normal.&quot;,&quot;Y&quot;:&quot;972781&quot;},{&quot;X&quot;:&quot;back.&quot;,&quot;Y&quot;:&quot;2203&quot;},{&quot;X&quot;:&quot;warezclient.&quot;,&quot;Y&quot;:&quot;1020&quot;},{&quot;X&quot;:&quot;guess_passwd.&quot;,&quot;Y&quot;:&quot;53&quot;},{&quot;X&quot;:&quot;ftp_write.&quot;,&quot;Y&quot;:&quot;8&quot;},{&quot;X&quot;:&quot;phf.&quot;,&quot;Y&quot;:&quot;4&quot;},{&quot;X&quot;:&quot;multihop.&quot;,&quot;Y&quot;:&quot;7&quot;},{&quot;X&quot;:&quot;loadmodule.&quot;,&quot;Y&quot;:&quot;9&quot;},{&quot;X&quot;:&quot;smurf.&quot;,&quot;Y&quot;:&quot;2807886&quot;},{&quot;X&quot;:&quot;perl.&quot;,&quot;Y&quot;:&quot;3&quot;},{&quot;X&quot;:&quot;spy.&quot;,&quot;Y&quot;:&quot;2&quot;},{&quot;X&quot;:&quot;buffer_overflow.&quot;,&quot;Y&quot;:&quot;30&quot;},{&quot;X&quot;:&quot;pod.&quot;,&quot;Y&quot;:&quot;264&quot;},{&quot;X&quot;:&quot;teardrop.&quot;,&quot;Y&quot;:&quot;979&quot;},{&quot;X&quot;:&quot;warezmaster.&quot;,&quot;Y&quot;:&quot;20&quot;}],&quot;genId&quot;:&quot;1256474407&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/barChart'], \n      function(playground, _magicbarChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicbarChart,\n    \"o\": {\"x\":\"X\",\"y\":\"Y\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script></div>\n            </div><div class=\"tab-pane\" id=\"tab2120066267-2\">\n            <div>\n    <script data-this=\"{&quot;dataId&quot;:&quot;anona197b7e050a49a782c255d29410ea6d6&quot;,&quot;dataInit&quot;:[{&quot;X&quot;:&quot;satan.&quot;,&quot;Y&quot;:&quot;15892&quot;},{&quot;X&quot;:&quot;rootkit.&quot;,&quot;Y&quot;:&quot;10&quot;},{&quot;X&quot;:&quot;portsweep.&quot;,&quot;Y&quot;:&quot;10413&quot;},{&quot;X&quot;:&quot;ipsweep.&quot;,&quot;Y&quot;:&quot;12481&quot;},{&quot;X&quot;:&quot;land.&quot;,&quot;Y&quot;:&quot;21&quot;},{&quot;X&quot;:&quot;imap.&quot;,&quot;Y&quot;:&quot;12&quot;},{&quot;X&quot;:&quot;nmap.&quot;,&quot;Y&quot;:&quot;2316&quot;},{&quot;X&quot;:&quot;neptune.&quot;,&quot;Y&quot;:&quot;1072017&quot;},{&quot;X&quot;:&quot;normal.&quot;,&quot;Y&quot;:&quot;972781&quot;},{&quot;X&quot;:&quot;back.&quot;,&quot;Y&quot;:&quot;2203&quot;},{&quot;X&quot;:&quot;warezclient.&quot;,&quot;Y&quot;:&quot;1020&quot;},{&quot;X&quot;:&quot;guess_passwd.&quot;,&quot;Y&quot;:&quot;53&quot;},{&quot;X&quot;:&quot;ftp_write.&quot;,&quot;Y&quot;:&quot;8&quot;},{&quot;X&quot;:&quot;phf.&quot;,&quot;Y&quot;:&quot;4&quot;},{&quot;X&quot;:&quot;multihop.&quot;,&quot;Y&quot;:&quot;7&quot;},{&quot;X&quot;:&quot;loadmodule.&quot;,&quot;Y&quot;:&quot;9&quot;},{&quot;X&quot;:&quot;smurf.&quot;,&quot;Y&quot;:&quot;2807886&quot;},{&quot;X&quot;:&quot;perl.&quot;,&quot;Y&quot;:&quot;3&quot;},{&quot;X&quot;:&quot;spy.&quot;,&quot;Y&quot;:&quot;2&quot;},{&quot;X&quot;:&quot;buffer_overflow.&quot;,&quot;Y&quot;:&quot;30&quot;},{&quot;X&quot;:&quot;pod.&quot;,&quot;Y&quot;:&quot;264&quot;},{&quot;X&quot;:&quot;teardrop.&quot;,&quot;Y&quot;:&quot;979&quot;},{&quot;X&quot;:&quot;warezmaster.&quot;,&quot;Y&quot;:&quot;20&quot;}],&quot;genId&quot;:&quot;1175691748&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/pieChart'], \n      function(playground, _magicpieChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicpieChart,\n    \"o\": {\"series\":\"X\",\"p\":\"Y\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script></div>\n            </div></div>\n      </div></div>\n <div class='pull-right text-info'><small>623 milliseconds</small></div>"},"output_type":"execute_result","execution_count":11}]},{"metadata":{},"cell_type":"markdown","source":"### For simplicity, selecting only non-numeric columns"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"//val nonNumericFrame = dataFrame.select(\"protocol_type\" ,\"service\", \"flag\")\nval labeledNumericFrame = dataFrame.select(\"label\", \"duration\",\"src_bytes\",\"dst_bytes\",\"land\",\"wrong_fragment\",\"urgent\",\"hot\",\"num_failed_logins\",\"logged_in\",\"num_compromised\",\"root_shell\",\"su_attempted\",\"num_root\",\"num_file_creations\",\"num_shells\",\"num_access_files\",\"num_outbound_cmds\",\"is_host_login\",\"is_guest_login\",\"count\",\"srv_count\",\"serror_rate\",\"srv_serror_rate\",\"rerror_rate\",\"srv_rerror_rate\",\"same_srv_rate\",\"diff_srv_rate\",\"srv_diff_host_rate\",\"dst_host_count\",\"dst_host_srv_count\",\"dst_host_same_srv_rate\",\"dst_host_diff_srv_rate\",\"dst_host_same_src_port_rate\",\"dst_host_srv_diff_host_rate\",\"dst_host_serror_rate\",\"dst_host_srv_serror_rate\",\"dst_host_rerror_rate\",\"dst_host_srv_rerror_rate\")\n\nlabeledNumericFrame.take(1)(0)","outputs":[{"name":"stdout","output_type":"stream","text":"labeledNumericFrame: org.apache.spark.sql.DataFrame = [label: string, duration: string, src_bytes: string, dst_bytes: string, land: string, wrong_fragment: string, urgent: string, hot: string, num_failed_logins: string, logged_in: string, num_compromised: string, root_shell: string, su_attempted: string, num_root: string, num_file_creations: string, num_shells: string, num_access_files: string, num_outbound_cmds: string, is_host_login: string, is_guest_login: string, count: string, srv_count: string, serror_rate: string, srv_serror_rate: string, rerror_rate: string, srv_rerror_rate: string, same_srv_rate: string, diff_srv_rate: string, srv_diff_host_rate: string, dst_host_count: string, dst_host_srv_count: string, dst_host_same_srv_rate: string, dst_host_diff_srv_rate: string, dst_host_..."},{"metadata":{},"data":{"text/html":"[normal.,0,215,45076,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,0.00,0.00,0.00,0.00,1.00,0.00,0.00,0,0,0.00,0.00,0.00,0.00,0.00,0.00,0.00,0.00]\n <div class='pull-right text-info'><small>592 milliseconds</small></div>"},"output_type":"execute_result","execution_count":12}]},{"metadata":{},"cell_type":"markdown","source":"### Running standard SQL queries against your dataset"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"dataFrame.registerTempTable(\"logs\")\nval allColumns = sqlContext.sql(\"SELECT * FROM logs WHERE protocol_type = 'udp' LIMIT 1\").first","outputs":[{"name":"stdout","output_type":"stream","text":"allColumns: org.apache.spark.sql.Row = [1,0.00,0,6,0.33,0.00,0.17,0.17,0.00,1,0.00,0.00,0.00,0,SF,0,0,0,normal.,0,0,0,0,0,0,0,0,0,udp,0.00,0,1.00,0.00,domain_u,30,2,1.00,0.00,0.00,0,0,0]\n"},{"metadata":{},"data":{"text/html":"[1,0.00,0,6,0.33,0.00,0.17,0.17,0.00,1,0.00,0.00,0.00,0,SF,0,0,0,normal.,0,0,0,0,0,0,0,0,0,udp,0.00,0,1.00,0.00,domain_u,30,2,1.00,0.00,0.00,0,0,0]\n <div class='pull-right text-info'><small>684 milliseconds</small></div>"},"output_type":"execute_result","execution_count":13}]},{"metadata":{},"cell_type":"markdown","source":"***\n## Build a clustering model -- Spark MLlib"},{"metadata":{},"cell_type":"markdown","source":"### Prepare the data"},{"metadata":{},"cell_type":"markdown","source":"#### Every row becomes (Label, Vector[numeric values])"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val labeledPoint = labeledNumericFrame.map(row => \n      (row.getString(0), Vectors.dense(row.toSeq.tail.map(s => if(s == null) 0.0 else s.toString.toDouble).toArray)))\n\nval rawData = labeledPoint.map(_._2)\nrawData.first","outputs":[{"name":"stdout","output_type":"stream","text":"labeledPoint: org.apache.spark.rdd.RDD[(String, org.apache.spark.mllib.linalg.Vector)] = MapPartitionsRDD[30] at map at DataFrame.scala:776\nrawData: org.apache.spark.rdd.RDD[org.apache.spark.mllib.linalg.Vector] = MapPartitionsRDD[31] at map at <console>:61\nres11: org.apache.spark.mllib.linalg.Vector = [0.0,215.0,45076.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]\n"},{"metadata":{},"data":{"text/html":"[0.0,215.0,45076.0,0.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,1.0,1.0,0.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]\n <div class='pull-right text-info'><small>578 milliseconds</small></div>"},"output_type":"execute_result","execution_count":14}]},{"metadata":{},"cell_type":"markdown","source":"#### Labels are not going to be used when building the model"},{"metadata":{},"cell_type":"markdown","source":"### Scale the features and cache the results"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val scaler = new StandardScaler().fit(rawData)\nval data = scaler.transform(rawData).cache","outputs":[{"name":"stdout","output_type":"stream","text":"scaler: org.apache.spark.mllib.feature.StandardScalerModel = org.apache.spark.mllib.feature.StandardScalerModel@72c8b675\ndata: org.apache.spark.rdd.RDD[org.apache.spark.mllib.linalg.Vector] = MapPartitionsRDD[36] at map at VectorTransformer.scala:49\n"},{"metadata":{},"data":{"text/html":"MapPartitionsRDD[36] at map at VectorTransformer.scala:49\n <div class='pull-right text-info'><small>11 seconds 745 milliseconds</small></div>"},"output_type":"execute_result","execution_count":15}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"data.first.toArray.toList","outputs":[{"name":"stdout","output_type":"stream","text":"res12: List[Double] = List(0.0, 2.2837572056585542E-4, 0.06988393499153402, 0.0, 0.0, 0.0, 0.0, 0.0, 2.8521592459052765, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.004717186229981802, 0.00406516111503739, 0.0, 0.0, 0.0, 0.0, 2.5687405411353823, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)\n"},{"metadata":{},"data":{"text/html":"<div>\n    <script data-this=\"{&quot;dataId&quot;:&quot;anondaa5397dbb68fa8f005853fa23f0b85b&quot;,&quot;dataInit&quot;:[{&quot;X&quot;:0,&quot;Y&quot;:0.0},{&quot;X&quot;:1,&quot;Y&quot;:0.00022837572056585542},{&quot;X&quot;:2,&quot;Y&quot;:0.06988393499153402},{&quot;X&quot;:3,&quot;Y&quot;:0.0},{&quot;X&quot;:4,&quot;Y&quot;:0.0},{&quot;X&quot;:5,&quot;Y&quot;:0.0},{&quot;X&quot;:6,&quot;Y&quot;:0.0},{&quot;X&quot;:7,&quot;Y&quot;:0.0},{&quot;X&quot;:8,&quot;Y&quot;:2.8521592459052765},{&quot;X&quot;:9,&quot;Y&quot;:0.0},{&quot;X&quot;:10,&quot;Y&quot;:0.0},{&quot;X&quot;:11,&quot;Y&quot;:0.0},{&quot;X&quot;:12,&quot;Y&quot;:0.0},{&quot;X&quot;:13,&quot;Y&quot;:0.0},{&quot;X&quot;:14,&quot;Y&quot;:0.0},{&quot;X&quot;:15,&quot;Y&quot;:0.0},{&quot;X&quot;:16,&quot;Y&quot;:0.0},{&quot;X&quot;:17,&quot;Y&quot;:0.0},{&quot;X&quot;:18,&quot;Y&quot;:0.0},{&quot;X&quot;:19,&quot;Y&quot;:0.004717186229981802},{&quot;X&quot;:20,&quot;Y&quot;:0.00406516111503739},{&quot;X&quot;:21,&quot;Y&quot;:0.0},{&quot;X&quot;:22,&quot;Y&quot;:0.0},{&quot;X&quot;:23,&quot;Y&quot;:0.0},{&quot;X&quot;:24,&quot;Y&quot;:0.0},{&quot;X&quot;:25,&quot;Y&quot;:2.5687405411353823},{&quot;X&quot;:26,&quot;Y&quot;:0.0},{&quot;X&quot;:27,&quot;Y&quot;:0.0},{&quot;X&quot;:28,&quot;Y&quot;:0.0},{&quot;X&quot;:29,&quot;Y&quot;:0.0},{&quot;X&quot;:30,&quot;Y&quot;:0.0},{&quot;X&quot;:31,&quot;Y&quot;:0.0},{&quot;X&quot;:32,&quot;Y&quot;:0.0},{&quot;X&quot;:33,&quot;Y&quot;:0.0},{&quot;X&quot;:34,&quot;Y&quot;:0.0},{&quot;X&quot;:35,&quot;Y&quot;:0.0},{&quot;X&quot;:36,&quot;Y&quot;:0.0},{&quot;X&quot;:37,&quot;Y&quot;:0.0}],&quot;genId&quot;:&quot;326398560&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tabs'], \n      function(playground, _magictabs) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictabs,\n    \"o\": {}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script><div>\n        <ul class=\"nav nav-tabs\" id=\"ul326398560\"><li>\n              <a href=\"#tab326398560-0\"><i class=\"fa fa-table\"/></a>\n            </li><li>\n              <a href=\"#tab326398560-1\"><i class=\"fa fa-dot-circle-o\"/></a>\n            </li><li>\n              <a href=\"#tab326398560-2\"><i class=\"fa fa-line-chart\"/></a>\n            </li><li>\n              <a href=\"#tab326398560-3\"><i class=\"fa fa-bar-chart\"/></a>\n            </li></ul>\n\n        <div class=\"tab-content\" id=\"tab326398560\"><div class=\"tab-pane\" id=\"tab326398560-0\">\n            <div>\n    <script data-this=\"{&quot;dataId&quot;:&quot;anon7e563624be956737c2ea0ed094626fd2&quot;,&quot;dataInit&quot;:[{&quot;X&quot;:0,&quot;Y&quot;:0.0},{&quot;X&quot;:1,&quot;Y&quot;:0.00022837572056585542},{&quot;X&quot;:2,&quot;Y&quot;:0.06988393499153402},{&quot;X&quot;:3,&quot;Y&quot;:0.0},{&quot;X&quot;:4,&quot;Y&quot;:0.0},{&quot;X&quot;:5,&quot;Y&quot;:0.0},{&quot;X&quot;:6,&quot;Y&quot;:0.0},{&quot;X&quot;:7,&quot;Y&quot;:0.0},{&quot;X&quot;:8,&quot;Y&quot;:2.8521592459052765},{&quot;X&quot;:9,&quot;Y&quot;:0.0},{&quot;X&quot;:10,&quot;Y&quot;:0.0},{&quot;X&quot;:11,&quot;Y&quot;:0.0},{&quot;X&quot;:12,&quot;Y&quot;:0.0},{&quot;X&quot;:13,&quot;Y&quot;:0.0},{&quot;X&quot;:14,&quot;Y&quot;:0.0},{&quot;X&quot;:15,&quot;Y&quot;:0.0},{&quot;X&quot;:16,&quot;Y&quot;:0.0},{&quot;X&quot;:17,&quot;Y&quot;:0.0},{&quot;X&quot;:18,&quot;Y&quot;:0.0},{&quot;X&quot;:19,&quot;Y&quot;:0.004717186229981802},{&quot;X&quot;:20,&quot;Y&quot;:0.00406516111503739},{&quot;X&quot;:21,&quot;Y&quot;:0.0},{&quot;X&quot;:22,&quot;Y&quot;:0.0},{&quot;X&quot;:23,&quot;Y&quot;:0.0},{&quot;X&quot;:24,&quot;Y&quot;:0.0}],&quot;genId&quot;:&quot;2021142334&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tableChart'], \n      function(playground, _magictableChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictableChart,\n    \"o\": {\"headers\":[\"X\",\"Y\"],\"nrow\":38,\"shown\":25,\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script></div>\n            </div><div class=\"tab-pane\" id=\"tab326398560-1\">\n            <div>\n    <script data-this=\"{&quot;dataId&quot;:&quot;anon362a34f9fc1b9342d5692d7e07215ec6&quot;,&quot;dataInit&quot;:[{&quot;X&quot;:0,&quot;Y&quot;:0.0},{&quot;X&quot;:1,&quot;Y&quot;:0.00022837572056585542},{&quot;X&quot;:2,&quot;Y&quot;:0.06988393499153402},{&quot;X&quot;:3,&quot;Y&quot;:0.0},{&quot;X&quot;:4,&quot;Y&quot;:0.0},{&quot;X&quot;:5,&quot;Y&quot;:0.0},{&quot;X&quot;:6,&quot;Y&quot;:0.0},{&quot;X&quot;:7,&quot;Y&quot;:0.0},{&quot;X&quot;:8,&quot;Y&quot;:2.8521592459052765},{&quot;X&quot;:9,&quot;Y&quot;:0.0},{&quot;X&quot;:10,&quot;Y&quot;:0.0},{&quot;X&quot;:11,&quot;Y&quot;:0.0},{&quot;X&quot;:12,&quot;Y&quot;:0.0},{&quot;X&quot;:13,&quot;Y&quot;:0.0},{&quot;X&quot;:14,&quot;Y&quot;:0.0},{&quot;X&quot;:15,&quot;Y&quot;:0.0},{&quot;X&quot;:16,&quot;Y&quot;:0.0},{&quot;X&quot;:17,&quot;Y&quot;:0.0},{&quot;X&quot;:18,&quot;Y&quot;:0.0},{&quot;X&quot;:19,&quot;Y&quot;:0.004717186229981802},{&quot;X&quot;:20,&quot;Y&quot;:0.00406516111503739},{&quot;X&quot;:21,&quot;Y&quot;:0.0},{&quot;X&quot;:22,&quot;Y&quot;:0.0},{&quot;X&quot;:23,&quot;Y&quot;:0.0},{&quot;X&quot;:24,&quot;Y&quot;:0.0},{&quot;X&quot;:25,&quot;Y&quot;:2.5687405411353823},{&quot;X&quot;:26,&quot;Y&quot;:0.0},{&quot;X&quot;:27,&quot;Y&quot;:0.0},{&quot;X&quot;:28,&quot;Y&quot;:0.0},{&quot;X&quot;:29,&quot;Y&quot;:0.0},{&quot;X&quot;:30,&quot;Y&quot;:0.0},{&quot;X&quot;:31,&quot;Y&quot;:0.0},{&quot;X&quot;:32,&quot;Y&quot;:0.0},{&quot;X&quot;:33,&quot;Y&quot;:0.0},{&quot;X&quot;:34,&quot;Y&quot;:0.0},{&quot;X&quot;:35,&quot;Y&quot;:0.0},{&quot;X&quot;:36,&quot;Y&quot;:0.0},{&quot;X&quot;:37,&quot;Y&quot;:0.0}],&quot;genId&quot;:&quot;1307999489&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/scatterChart'], \n      function(playground, _magicscatterChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicscatterChart,\n    \"o\": {\"x\":\"X\",\"y\":\"Y\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script></div>\n            </div><div class=\"tab-pane\" id=\"tab326398560-2\">\n            <div>\n    <script data-this=\"{&quot;dataId&quot;:&quot;anona57631547488c804d57988ec605c8de4&quot;,&quot;dataInit&quot;:[{&quot;X&quot;:0,&quot;Y&quot;:0.0},{&quot;X&quot;:1,&quot;Y&quot;:0.00022837572056585542},{&quot;X&quot;:2,&quot;Y&quot;:0.06988393499153402},{&quot;X&quot;:3,&quot;Y&quot;:0.0},{&quot;X&quot;:4,&quot;Y&quot;:0.0},{&quot;X&quot;:5,&quot;Y&quot;:0.0},{&quot;X&quot;:6,&quot;Y&quot;:0.0},{&quot;X&quot;:7,&quot;Y&quot;:0.0},{&quot;X&quot;:8,&quot;Y&quot;:2.8521592459052765},{&quot;X&quot;:9,&quot;Y&quot;:0.0},{&quot;X&quot;:10,&quot;Y&quot;:0.0},{&quot;X&quot;:11,&quot;Y&quot;:0.0},{&quot;X&quot;:12,&quot;Y&quot;:0.0},{&quot;X&quot;:13,&quot;Y&quot;:0.0},{&quot;X&quot;:14,&quot;Y&quot;:0.0},{&quot;X&quot;:15,&quot;Y&quot;:0.0},{&quot;X&quot;:16,&quot;Y&quot;:0.0},{&quot;X&quot;:17,&quot;Y&quot;:0.0},{&quot;X&quot;:18,&quot;Y&quot;:0.0},{&quot;X&quot;:19,&quot;Y&quot;:0.004717186229981802},{&quot;X&quot;:20,&quot;Y&quot;:0.00406516111503739},{&quot;X&quot;:21,&quot;Y&quot;:0.0},{&quot;X&quot;:22,&quot;Y&quot;:0.0},{&quot;X&quot;:23,&quot;Y&quot;:0.0},{&quot;X&quot;:24,&quot;Y&quot;:0.0},{&quot;X&quot;:25,&quot;Y&quot;:2.5687405411353823},{&quot;X&quot;:26,&quot;Y&quot;:0.0},{&quot;X&quot;:27,&quot;Y&quot;:0.0},{&quot;X&quot;:28,&quot;Y&quot;:0.0},{&quot;X&quot;:29,&quot;Y&quot;:0.0},{&quot;X&quot;:30,&quot;Y&quot;:0.0},{&quot;X&quot;:31,&quot;Y&quot;:0.0},{&quot;X&quot;:32,&quot;Y&quot;:0.0},{&quot;X&quot;:33,&quot;Y&quot;:0.0},{&quot;X&quot;:34,&quot;Y&quot;:0.0},{&quot;X&quot;:35,&quot;Y&quot;:0.0},{&quot;X&quot;:36,&quot;Y&quot;:0.0},{&quot;X&quot;:37,&quot;Y&quot;:0.0}],&quot;genId&quot;:&quot;22246740&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/lineChart'], \n      function(playground, _magiclineChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magiclineChart,\n    \"o\": {\"x\":\"X\",\"y\":\"Y\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script></div>\n            </div><div class=\"tab-pane\" id=\"tab326398560-3\">\n            <div>\n    <script data-this=\"{&quot;dataId&quot;:&quot;anon7c3b8109a7089b552200820c83ba6aa7&quot;,&quot;dataInit&quot;:[{&quot;X&quot;:0,&quot;Y&quot;:0.0},{&quot;X&quot;:1,&quot;Y&quot;:0.00022837572056585542},{&quot;X&quot;:2,&quot;Y&quot;:0.06988393499153402},{&quot;X&quot;:3,&quot;Y&quot;:0.0},{&quot;X&quot;:4,&quot;Y&quot;:0.0},{&quot;X&quot;:5,&quot;Y&quot;:0.0},{&quot;X&quot;:6,&quot;Y&quot;:0.0},{&quot;X&quot;:7,&quot;Y&quot;:0.0},{&quot;X&quot;:8,&quot;Y&quot;:2.8521592459052765},{&quot;X&quot;:9,&quot;Y&quot;:0.0},{&quot;X&quot;:10,&quot;Y&quot;:0.0},{&quot;X&quot;:11,&quot;Y&quot;:0.0},{&quot;X&quot;:12,&quot;Y&quot;:0.0},{&quot;X&quot;:13,&quot;Y&quot;:0.0},{&quot;X&quot;:14,&quot;Y&quot;:0.0},{&quot;X&quot;:15,&quot;Y&quot;:0.0},{&quot;X&quot;:16,&quot;Y&quot;:0.0},{&quot;X&quot;:17,&quot;Y&quot;:0.0},{&quot;X&quot;:18,&quot;Y&quot;:0.0},{&quot;X&quot;:19,&quot;Y&quot;:0.004717186229981802},{&quot;X&quot;:20,&quot;Y&quot;:0.00406516111503739},{&quot;X&quot;:21,&quot;Y&quot;:0.0},{&quot;X&quot;:22,&quot;Y&quot;:0.0},{&quot;X&quot;:23,&quot;Y&quot;:0.0},{&quot;X&quot;:24,&quot;Y&quot;:0.0},{&quot;X&quot;:25,&quot;Y&quot;:2.5687405411353823},{&quot;X&quot;:26,&quot;Y&quot;:0.0},{&quot;X&quot;:27,&quot;Y&quot;:0.0},{&quot;X&quot;:28,&quot;Y&quot;:0.0},{&quot;X&quot;:29,&quot;Y&quot;:0.0},{&quot;X&quot;:30,&quot;Y&quot;:0.0},{&quot;X&quot;:31,&quot;Y&quot;:0.0},{&quot;X&quot;:32,&quot;Y&quot;:0.0},{&quot;X&quot;:33,&quot;Y&quot;:0.0},{&quot;X&quot;:34,&quot;Y&quot;:0.0},{&quot;X&quot;:35,&quot;Y&quot;:0.0},{&quot;X&quot;:36,&quot;Y&quot;:0.0},{&quot;X&quot;:37,&quot;Y&quot;:0.0}],&quot;genId&quot;:&quot;1377923292&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/barChart'], \n      function(playground, _magicbarChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicbarChart,\n    \"o\": {\"x\":\"X\",\"y\":\"Y\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script></div>\n            </div></div>\n      </div></div>\n <div class='pull-right text-info'><small>852 milliseconds</small></div>"},"output_type":"execute_result","execution_count":16}]},{"metadata":{},"cell_type":"markdown","source":"### Use K-Means clustering"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val numIterations = 10\n//in production it should be more","outputs":[{"name":"stdout","output_type":"stream","text":"numIterations: Int = 10\n"},{"metadata":{},"data":{"text/html":"10\n <div class='pull-right text-info'><small>279 milliseconds</small></div>"},"output_type":"execute_result","execution_count":17}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val K = 150","outputs":[{"name":"stdout","output_type":"stream","text":"K: Int = 150\n"},{"metadata":{},"data":{"text/html":"150\n <div class='pull-right text-info'><small>228 milliseconds</small></div>"},"output_type":"execute_result","execution_count":18}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val clusters = KMeans.train(data, K, numIterations)","outputs":[{"name":"stdout","output_type":"stream","text":"clusters: org.apache.spark.mllib.clustering.KMeansModel = org.apache.spark.mllib.clustering.KMeansModel@407c3db3\n"},{"metadata":{},"data":{"text/html":"org.apache.spark.mllib.clustering.KMeansModel@407c3db3\n <div class='pull-right text-info'><small>1 minute 51 seconds 804 milliseconds</small></div>"},"output_type":"execute_result","execution_count":19}]},{"metadata":{},"cell_type":"markdown","source":"#### Meantime let's have a look at Spark UI"},{"metadata":{},"cell_type":"markdown","source":"### Now we have our model, let's apply it to the data"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val predictions = labeledPoint.map(x => (clusters.predict(scaler.transform(x._2)), x._1))\npredictions.count","outputs":[{"name":"stdout","output_type":"stream","text":"predictions: org.apache.spark.rdd.RDD[(Int, String)] = MapPartitionsRDD[84] at map at <console>:72\nres13: Long = 4898431\n"},{"metadata":{},"data":{"text/html":"4898431\n <div class='pull-right text-info'><small>20 seconds 700 milliseconds</small></div>"},"output_type":"execute_result","execution_count":20}]},{"metadata":{},"cell_type":"markdown","source":"#### And let's see the clusters and their size"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"val clustersWithSize = predictions.map(x => (x._1, 1)).reduceByKey((x,y) => x+y)","outputs":[{"name":"stdout","output_type":"stream","text":"clustersWithSize: org.apache.spark.rdd.RDD[(Int, Int)] = ShuffledRDD[86] at reduceByKey at <console>:74\n"},{"metadata":{},"data":{"text/html":"ShuffledRDD[86] at reduceByKey at &lt;console&gt;:74\n <div class='pull-right text-info'><small>381 milliseconds</small></div>"},"output_type":"execute_result","execution_count":21}]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":false},"cell_type":"code","source":"clustersWithSize.take(25).toList","outputs":[{"name":"stdout","output_type":"stream","text":"res14: List[(Int, Int)] = List((137,431), (0,484153), (138,104048), (1,2804096), (139,206), (2,16865), (140,6566), (3,92668), (4,9), (141,1206), (142,2), (5,970), (143,2054), (6,28), (7,50), (144,10680), (8,23789), (145,1365), (146,5), (9,240), (10,1), (147,2097), (11,2772), (148,479), (149,793))\n"},{"metadata":{},"data":{"text/html":"<div>\n    <script data-this=\"{&quot;dataId&quot;:&quot;anond207a8fa8ae77fd847f993b57ff693d4&quot;,&quot;dataInit&quot;:[{&quot;X&quot;:137,&quot;Y&quot;:431},{&quot;X&quot;:0,&quot;Y&quot;:484153},{&quot;X&quot;:138,&quot;Y&quot;:104048},{&quot;X&quot;:1,&quot;Y&quot;:2804096},{&quot;X&quot;:139,&quot;Y&quot;:206},{&quot;X&quot;:2,&quot;Y&quot;:16865},{&quot;X&quot;:140,&quot;Y&quot;:6566},{&quot;X&quot;:3,&quot;Y&quot;:92668},{&quot;X&quot;:4,&quot;Y&quot;:9},{&quot;X&quot;:141,&quot;Y&quot;:1206},{&quot;X&quot;:142,&quot;Y&quot;:2},{&quot;X&quot;:5,&quot;Y&quot;:970},{&quot;X&quot;:143,&quot;Y&quot;:2054},{&quot;X&quot;:6,&quot;Y&quot;:28},{&quot;X&quot;:7,&quot;Y&quot;:50},{&quot;X&quot;:144,&quot;Y&quot;:10680},{&quot;X&quot;:8,&quot;Y&quot;:23789},{&quot;X&quot;:145,&quot;Y&quot;:1365},{&quot;X&quot;:146,&quot;Y&quot;:5},{&quot;X&quot;:9,&quot;Y&quot;:240},{&quot;X&quot;:10,&quot;Y&quot;:1},{&quot;X&quot;:147,&quot;Y&quot;:2097},{&quot;X&quot;:11,&quot;Y&quot;:2772},{&quot;X&quot;:148,&quot;Y&quot;:479},{&quot;X&quot;:149,&quot;Y&quot;:793}],&quot;genId&quot;:&quot;556547341&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tabs'], \n      function(playground, _magictabs) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictabs,\n    \"o\": {}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script><div>\n        <ul class=\"nav nav-tabs\" id=\"ul556547341\"><li>\n              <a href=\"#tab556547341-0\"><i class=\"fa fa-table\"/></a>\n            </li><li>\n              <a href=\"#tab556547341-1\"><i class=\"fa fa-dot-circle-o\"/></a>\n            </li><li>\n              <a href=\"#tab556547341-2\"><i class=\"fa fa-line-chart\"/></a>\n            </li><li>\n              <a href=\"#tab556547341-3\"><i class=\"fa fa-bar-chart\"/></a>\n            </li></ul>\n\n        <div class=\"tab-content\" id=\"tab556547341\"><div class=\"tab-pane\" id=\"tab556547341-0\">\n            <div>\n    <script data-this=\"{&quot;dataId&quot;:&quot;anonf102faa89f4449282fef213b9ce9be37&quot;,&quot;dataInit&quot;:[{&quot;X&quot;:137,&quot;Y&quot;:431},{&quot;X&quot;:0,&quot;Y&quot;:484153},{&quot;X&quot;:138,&quot;Y&quot;:104048},{&quot;X&quot;:1,&quot;Y&quot;:2804096},{&quot;X&quot;:139,&quot;Y&quot;:206},{&quot;X&quot;:2,&quot;Y&quot;:16865},{&quot;X&quot;:140,&quot;Y&quot;:6566},{&quot;X&quot;:3,&quot;Y&quot;:92668},{&quot;X&quot;:4,&quot;Y&quot;:9},{&quot;X&quot;:141,&quot;Y&quot;:1206},{&quot;X&quot;:142,&quot;Y&quot;:2},{&quot;X&quot;:5,&quot;Y&quot;:970},{&quot;X&quot;:143,&quot;Y&quot;:2054},{&quot;X&quot;:6,&quot;Y&quot;:28},{&quot;X&quot;:7,&quot;Y&quot;:50},{&quot;X&quot;:144,&quot;Y&quot;:10680},{&quot;X&quot;:8,&quot;Y&quot;:23789},{&quot;X&quot;:145,&quot;Y&quot;:1365},{&quot;X&quot;:146,&quot;Y&quot;:5},{&quot;X&quot;:9,&quot;Y&quot;:240},{&quot;X&quot;:10,&quot;Y&quot;:1},{&quot;X&quot;:147,&quot;Y&quot;:2097},{&quot;X&quot;:11,&quot;Y&quot;:2772},{&quot;X&quot;:148,&quot;Y&quot;:479},{&quot;X&quot;:149,&quot;Y&quot;:793}],&quot;genId&quot;:&quot;1650887529&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/tableChart'], \n      function(playground, _magictableChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magictableChart,\n    \"o\": {\"headers\":[\"X\",\"Y\"],\"nrow\":25,\"shown\":25,\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script></div>\n            </div><div class=\"tab-pane\" id=\"tab556547341-1\">\n            <div>\n    <script data-this=\"{&quot;dataId&quot;:&quot;anonec2561f5cb6c7390dde935b945e47372&quot;,&quot;dataInit&quot;:[{&quot;X&quot;:137,&quot;Y&quot;:431},{&quot;X&quot;:0,&quot;Y&quot;:484153},{&quot;X&quot;:138,&quot;Y&quot;:104048},{&quot;X&quot;:1,&quot;Y&quot;:2804096},{&quot;X&quot;:139,&quot;Y&quot;:206},{&quot;X&quot;:2,&quot;Y&quot;:16865},{&quot;X&quot;:140,&quot;Y&quot;:6566},{&quot;X&quot;:3,&quot;Y&quot;:92668},{&quot;X&quot;:4,&quot;Y&quot;:9},{&quot;X&quot;:141,&quot;Y&quot;:1206},{&quot;X&quot;:142,&quot;Y&quot;:2},{&quot;X&quot;:5,&quot;Y&quot;:970},{&quot;X&quot;:143,&quot;Y&quot;:2054},{&quot;X&quot;:6,&quot;Y&quot;:28},{&quot;X&quot;:7,&quot;Y&quot;:50},{&quot;X&quot;:144,&quot;Y&quot;:10680},{&quot;X&quot;:8,&quot;Y&quot;:23789},{&quot;X&quot;:145,&quot;Y&quot;:1365},{&quot;X&quot;:146,&quot;Y&quot;:5},{&quot;X&quot;:9,&quot;Y&quot;:240},{&quot;X&quot;:10,&quot;Y&quot;:1},{&quot;X&quot;:147,&quot;Y&quot;:2097},{&quot;X&quot;:11,&quot;Y&quot;:2772},{&quot;X&quot;:148,&quot;Y&quot;:479},{&quot;X&quot;:149,&quot;Y&quot;:793}],&quot;genId&quot;:&quot;933597125&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/scatterChart'], \n      function(playground, _magicscatterChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicscatterChart,\n    \"o\": {\"x\":\"X\",\"y\":\"Y\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script></div>\n            </div><div class=\"tab-pane\" id=\"tab556547341-2\">\n            <div>\n    <script data-this=\"{&quot;dataId&quot;:&quot;anon1b659c1b3fadb6019714ef42e85b742b&quot;,&quot;dataInit&quot;:[{&quot;X&quot;:137,&quot;Y&quot;:431},{&quot;X&quot;:0,&quot;Y&quot;:484153},{&quot;X&quot;:138,&quot;Y&quot;:104048},{&quot;X&quot;:1,&quot;Y&quot;:2804096},{&quot;X&quot;:139,&quot;Y&quot;:206},{&quot;X&quot;:2,&quot;Y&quot;:16865},{&quot;X&quot;:140,&quot;Y&quot;:6566},{&quot;X&quot;:3,&quot;Y&quot;:92668},{&quot;X&quot;:4,&quot;Y&quot;:9},{&quot;X&quot;:141,&quot;Y&quot;:1206},{&quot;X&quot;:142,&quot;Y&quot;:2},{&quot;X&quot;:5,&quot;Y&quot;:970},{&quot;X&quot;:143,&quot;Y&quot;:2054},{&quot;X&quot;:6,&quot;Y&quot;:28},{&quot;X&quot;:7,&quot;Y&quot;:50},{&quot;X&quot;:144,&quot;Y&quot;:10680},{&quot;X&quot;:8,&quot;Y&quot;:23789},{&quot;X&quot;:145,&quot;Y&quot;:1365},{&quot;X&quot;:146,&quot;Y&quot;:5},{&quot;X&quot;:9,&quot;Y&quot;:240},{&quot;X&quot;:10,&quot;Y&quot;:1},{&quot;X&quot;:147,&quot;Y&quot;:2097},{&quot;X&quot;:11,&quot;Y&quot;:2772},{&quot;X&quot;:148,&quot;Y&quot;:479},{&quot;X&quot;:149,&quot;Y&quot;:793}],&quot;genId&quot;:&quot;651317475&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/lineChart'], \n      function(playground, _magiclineChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magiclineChart,\n    \"o\": {\"x\":\"X\",\"y\":\"Y\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script></div>\n            </div><div class=\"tab-pane\" id=\"tab556547341-3\">\n            <div>\n    <script data-this=\"{&quot;dataId&quot;:&quot;anondf771494555619e05557704a1b25d211&quot;,&quot;dataInit&quot;:[{&quot;X&quot;:137,&quot;Y&quot;:431},{&quot;X&quot;:0,&quot;Y&quot;:484153},{&quot;X&quot;:138,&quot;Y&quot;:104048},{&quot;X&quot;:1,&quot;Y&quot;:2804096},{&quot;X&quot;:139,&quot;Y&quot;:206},{&quot;X&quot;:2,&quot;Y&quot;:16865},{&quot;X&quot;:140,&quot;Y&quot;:6566},{&quot;X&quot;:3,&quot;Y&quot;:92668},{&quot;X&quot;:4,&quot;Y&quot;:9},{&quot;X&quot;:141,&quot;Y&quot;:1206},{&quot;X&quot;:142,&quot;Y&quot;:2},{&quot;X&quot;:5,&quot;Y&quot;:970},{&quot;X&quot;:143,&quot;Y&quot;:2054},{&quot;X&quot;:6,&quot;Y&quot;:28},{&quot;X&quot;:7,&quot;Y&quot;:50},{&quot;X&quot;:144,&quot;Y&quot;:10680},{&quot;X&quot;:8,&quot;Y&quot;:23789},{&quot;X&quot;:145,&quot;Y&quot;:1365},{&quot;X&quot;:146,&quot;Y&quot;:5},{&quot;X&quot;:9,&quot;Y&quot;:240},{&quot;X&quot;:10,&quot;Y&quot;:1},{&quot;X&quot;:147,&quot;Y&quot;:2097},{&quot;X&quot;:11,&quot;Y&quot;:2772},{&quot;X&quot;:148,&quot;Y&quot;:479},{&quot;X&quot;:149,&quot;Y&quot;:793}],&quot;genId&quot;:&quot;50081223&quot;}\" type=\"text/x-scoped-javascript\">/*<![CDATA[*/req(['../javascripts/notebook/playground','../javascripts/notebook/magic/barChart'], \n      function(playground, _magicbarChart) {\n        // data ==> data-this (in observable.js's scopedEval) ==> this in JS => { dataId, dataInit, ... }\n        // this ==> scope (in observable.js's scopedEval) ==> this.parentElement ==> div.container below (toHtml)\n\n        playground.call(data,\n                        this\n                        ,\n                        {\n    \"f\": _magicbarChart,\n    \"o\": {\"x\":\"X\",\"y\":\"Y\",\"width\":600,\"height\":400}\n  }\n  \n                        \n                        \n                      );\n      }\n    );/*]]>*/</script></div>\n            </div></div>\n      </div></div>\n <div class='pull-right text-info'><small>21 seconds 694 milliseconds</small></div>"},"output_type":"execute_result","execution_count":22}]},{"metadata":{},"cell_type":"markdown","source":"##Use case assumption:\n**All the clusters with only one point in them labeled 'normal' are fishy**"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true},"cell_type":"code","source":"val clustersWithCountAndLabel = clustersWithSize.join(predictions).distinct\nclustersWithCountAndLabel.take(20).toList","outputs":[]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true},"cell_type":"code","source":"//clusters with 1 point and labeled as normal\nval suspectedAnomalousClusters = clustersWithCountAndLabel.filter(x => x._2._1 == 1 && x._2._2 == \"normal.\").map( x => x._1 )","outputs":[]},{"metadata":{},"cell_type":"markdown","source":"### Now we have discovered the anomalous clusters"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true},"cell_type":"code","source":"val anomalousClusters = suspectedAnomalousClusters.collect\nanomalousClusters.toList","outputs":[]},{"metadata":{},"cell_type":"markdown","source":"***\n## Listen to the stream of events and predict anomaly -- Spark streaming"},{"metadata":{},"cell_type":"markdown","source":"#### To create the real-time stream we will use the test dataset from the competition (in CSV format)"},{"metadata":{},"cell_type":"markdown","source":"<code>0,tcp,private,REJ,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,107,6,0.00,0.00,1.00,1.00,\n0.06,0.07,0.00,255,6,0.02,0.05,0.00,0.00,0.00,0.00,1.00,1.00</code>\n"},{"metadata":{},"cell_type":"markdown","source":"### We will use a simple Java app that reads in the logs and sends them to a TCP socket"},{"metadata":{},"cell_type":"markdown","source":"### Create streaming context with batch 2s "},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true},"cell_type":"code","source":"val ssc = new StreamingContext(sparkContext, Seconds(2))","outputs":[]},{"metadata":{},"cell_type":"markdown","source":"#### Turn down the logging"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true},"cell_type":"code","source":"Logger.getRootLogger.setLevel(Level.ERROR)","outputs":[]},{"metadata":{},"cell_type":"markdown","source":"#### Helper method for removing non-numeric columns"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true},"cell_type":"code","source":"def extractNumericColumns(r: RDD[Array[String]]): RDD[Vector] = {\n  val nonNumericColumns = List(1, 2, 3)\n  r.map(s => Vectors.dense(s.filterNot(f => nonNumericColumns.contains(s.indexOf(f))).\n                           map(st => if(st == null) 0.0 else st.toDouble).toArray))\n}","outputs":[]},{"metadata":{},"cell_type":"markdown","source":"#### Helper method for finding the anomalies"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true},"cell_type":"code","source":"def findAnomaly(r: RDD[Int], anomalousClusters: Array[Int]): RDD[String] = {\n  r.filter(x => anomalousClusters.contains(x)).map(x => \"Suspected anomaly - entry in cluster \" + x)\n}","outputs":[]},{"metadata":{},"cell_type":"markdown","source":"###  Start listening to the stream"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true},"cell_type":"code","source":"val lines = ssc.socketTextStream(\"localhost\", 9999)\n\nlines.map(x => x.split(\",\")).transform(y => extractNumericColumns(y)).\n  transform(x => clusters.predict(scaler.transform(x))).\n  transform(x => findAnomaly(x, anomalousClusters)).print","outputs":[]},{"metadata":{},"cell_type":"markdown","source":"# Hackers and fraudsters beware!"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true},"cell_type":"code","source":"ssc.start()\nssc.awaitTermination()","outputs":[]},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true},"cell_type":"markdown","source":"#### Spark UI now is showing Streaming tab"},{"metadata":{"trusted":true,"input_collapsed":false,"collapsed":true},"cell_type":"code","source":"","outputs":[]}],"nbformat":4},"name":"AnomalyDetectionDemo","path":"streaming/AnomalyDetectionDemo.snb","writable":true}